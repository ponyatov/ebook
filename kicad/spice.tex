\secru{Quick Guide to Using KiCad for SPICE Simulation}

\cp{http://www.mithatkonar.com/wiki/doku.php/kicad/kicad\_spice\_quick\_guide}

This is written up assuming you know the basics of using KiCad already.

\secdown

\secru{What you'll need}

You'll need the following to get a working SPICE setup:

\begin{itemize}
\item KiCad
\item A SPICE engine:
\begin{itemize}
\item \href{http://ngspice.sourceforge.net/}{ngspice}: Arguably the most FOSSy
commonly available SPICE engine.
\item
\href{https://www.gnu.org/software/gnucap/}{gnucap}\footnote{уже включен в
виндозную сборку KiCAD}:
Not actually SPICE but tries to be syntax-compatible.
\item \href{http://www.spiceopus.si/}{SpiceOpus}: Proprietary but nice,
especially the output plotting.
\item \href{http://www.linear.com/designtools/software/}{LTSpice}: Linear
Technology's popular, proprietary Windows solution.
Works in \href{http://www.winehq.org/}{Wine}. Has a GUI anyway, so … ? Whether
it's scritable needs to be verified.
\item
\href{http://www.cadence.com/products/orcad/pspice_simulation/Pages/default.aspx}{PSpice}:
Windows-only, expensive, defacto standard professional solution in the USA. They
also have a tradition of making available a \emph{gratis} crippleware student
version.
Also has a \underline{GUI}, so … ?
\item Any others?
\end{itemize}
\item Component libraries with SPICE symbols
\begin{itemize}
  
\item There is a library of basic SPICE components that ships with KiCad. It's
good enough for initial experimentation.

\begin{itemize}
\item The library isn't included in Eeschema projects by default. You'll have to
add it manually if you want to use it.
In Debian-based Linux, it's at \\/usr/share/kicad/library/pspice.lib. (PSpice is
a popular proprietary version of SPICE.)
\end{itemize} 

\item I am developing (very slowly)
\href{https://bitbucket.org/mithat/kicad-spice-library}{my own 
library}\footnote{Mithat Konar \email{webs@mithatkonar.com}}
of components based on the above with some changes and additions.
 
\end{itemize} 

\end{itemize}

\secru{Configuring a project}

\begin{enumerate}
\item Create a new project in the conventional way.
\item Open Eeschema and remove all the library references included by default.
\item Manually add one or more libraries with SPICE components to the project.
\begin{itemize}
  \item Note that the SPICE library that comes packaged with KiCad is not
  included by default in new KiCad projects.
\end{itemize}
\item Specify the SPICE engine you want to use:
\begin{itemize}
  \item Click the “Generate netlist” button (or the equivalent menu item).
  \item Select the “Spice” tab
  \item Enter the name of the command to invoke the simulator (with or without
path) in the “Simulator command:” textbox.
\end{itemize}
\end{enumerate}

\secru{Making it happen}

\begin{enumerate}
  \item 
Do your schematic capture, subject to a couple best practices:
\begin{itemize}
  \item 
For named nets, use global labels instead of local labels.
\begin{itemize}
  \item 
The reason for this is that in the netlists, global identifiers will be used
as-is but local labels get text prepended to the name—which makes it hard for
you to remember/guess what the full identifier is.
\end{itemize}
Use the ”0” component from a SPICE component library rather than the GND symbol.
\begin{itemize}
  \item 
”0” is the official name of ground node in SPICE. Some engines may translate GND
into 0, some may not.
\end{itemize}
\end{itemize}
  \item 
Specify the simulations you want to run and the output you want to display by
adding a text block (i.e., “comment”) with the needed SPICE and Nutmeg syntax
plus a little added mojo. To do an AC analysis and plot the response at node
\verb|vout|, you would add the following block:
\begin{lstlisting}[style=SPICE]
+PSPICE 
.control
ac dec 66 1kHz 120kHz 
plot vdb(vout)
set units = degrees
plot vp(vout)
.endc
\end{lstlisting}
\begin{itemize}
  \item 
The line +PSPICE is KiCad-speak for, “Stick the following text at the end of a
SPICE netlist.”
\begin{itemize}
  \item 
\textcircled{!} There appears to be a bug in the parser that requires you to add
a space after +PSPICE and before the line break.
\end{itemize}
  \item 
There is a corresponding -PSPICE that is KiCad-speak for, “Stick the following
text at the start of a SPICE netlist.”
  \item 
If you don't like seeing references to PSpice in your designs, you can use
+GNUCAP and -GNUCAP instead. I believe they are exact synonyms in this context,
but I am not certain.
  \item 
Yes, this means you need to learn some
\href{http://newton.ex.ac.uk/teaching/cdhw/Electronics2/userguide/sec5.html}{SPICE
and Nutmeg} syntax. It's not hard.
\end{itemize}
  \item 
Run the simulation:
\begin{itemize}
  \item 
Click the “Generate netlist” button (or the equivalent menu item).
  \item 
Select the “Spice” tab, and make sure “Default format” is checked. (You should
only have to do this once; it will just save you time in subsequent invocations
of the dialog.)
  \item 
Click the “Run simulator” button.
\end{itemize}
\end{enumerate}

\secup
